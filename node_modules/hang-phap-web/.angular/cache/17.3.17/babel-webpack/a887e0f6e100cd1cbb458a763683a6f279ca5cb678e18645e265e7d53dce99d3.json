{"ast":null,"code":"import { inject } from '@angular/core';\nimport { catchError, switchMap, throwError } from 'rxjs';\nimport { AuthService } from '../services/auth.service';\nimport { TokenStorageService } from '../services/token-storage.service';\nexport const authInterceptor = (req, next) => {\n  const storage = inject(TokenStorageService);\n  const authService = inject(AuthService);\n  const token = storage.getAccessToken();\n  const authReq = token ? req.clone({\n    setHeaders: {\n      Authorization: `Bearer ${token}`\n    }\n  }) : req;\n  return next(authReq).pipe(catchError(error => {\n    if (error.status !== 401) {\n      return throwError(() => error);\n    }\n    return authService.refresh().pipe(switchMap(res => {\n      const refreshToken = storage.getRefreshToken();\n      if (!refreshToken) {\n        authService.logout();\n        return throwError(() => error);\n      }\n      storage.setTokens(res.accessToken, refreshToken);\n      const retryReq = req.clone({\n        setHeaders: {\n          Authorization: `Bearer ${res.accessToken}`\n        }\n      });\n      return next(retryReq);\n    }));\n  }));\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}